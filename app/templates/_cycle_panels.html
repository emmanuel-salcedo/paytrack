<section class="grid" aria-label="Cycle snapshots">
  {% for snapshot in [current_cycle_snapshot, next_cycle_snapshot] %}
    <article class="card">
      <h2>{{ snapshot.label }}</h2>
      <div class="row"><span>Range</span><strong>{{ snapshot.cycle_start }} → {{ snapshot.cycle_end }}</strong></div>
      <div class="row"><span>Occurrences</span><strong>{{ snapshot.occurrence_count }}</strong></div>
      <div class="row"><span>Scheduled</span><strong>${{ '%.2f'|format(snapshot.scheduled_total) }}</strong></div>
      <div class="row"><span>Paid</span><strong>${{ '%.2f'|format(snapshot.paid_total) }}</strong></div>
      <div class="row"><span>Skipped</span><strong>${{ '%.2f'|format(snapshot.skipped_total) }}</strong></div>
      <div class="row"><span>Remaining</span><strong>${{ '%.2f'|format(snapshot.remaining_total) }}</strong></div>

      {% if snapshot.occurrences %}
        <table class="payments-table compact-table">
          <thead>
            <tr>
              <th>Due</th>
              <th>Payment</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for row in snapshot.occurrences %}
              <tr>
                <td>{{ row.due_date }}</td>
                <td>{{ row.payment_name }}</td>
                <td>${{ '%.2f'|format(row.expected_amount) }}</td>
                <td><span class="status-pill status-{{ row.status }}">{{ row.status }}</span></td>
                <td class="actions-cell">
                  {% if row.status == "scheduled" %}
                    <form
                      hx-post="/occurrences/{{ row.occurrence_id }}/mark-paid"
                      hx-target="#interactive-panels"
                      hx-swap="outerHTML"
                      method="post"
                      class="inline-form"
                    >
                      <button type="submit">Mark Paid</button>
                    </form>
                    <form
                      hx-post="/occurrences/{{ row.occurrence_id }}/skip"
                      hx-target="#interactive-panels"
                      hx-swap="outerHTML"
                      method="post"
                      class="inline-form"
                    >
                      <button type="submit">Skip</button>
                    </form>
                    <details>
                      <summary>Edit Paid</summary>
                      <form
                        hx-post="/occurrences/{{ row.occurrence_id }}/mark-paid"
                        hx-target="#interactive-panels"
                        hx-swap="outerHTML"
                        method="post"
                        class="stack"
                      >
                        <label>
                          <span>Amount Paid</span>
                          <input type="number" name="amount_paid" min="0" step="0.01" placeholder="{{ '%.2f'|format(row.expected_amount) }}">
                        </label>
                        <label>
                          <span>Paid Date</span>
                          <input type="date" name="paid_date">
                        </label>
                        <button type="submit">Save Paid</button>
                      </form>
                    </details>
                  {% elif row.status == "completed" %}
                    <form
                      hx-post="/occurrences/{{ row.occurrence_id }}/undo-paid"
                      hx-target="#interactive-panels"
                      hx-swap="outerHTML"
                      method="post"
                      class="inline-form"
                    >
                      <button type="submit">Undo</button>
                    </form>
                    <details>
                      <summary>Edit Paid</summary>
                      <form
                        hx-post="/occurrences/{{ row.occurrence_id }}/mark-paid"
                        hx-target="#interactive-panels"
                        hx-swap="outerHTML"
                        method="post"
                        class="stack"
                      >
                        <label>
                          <span>Amount Paid</span>
                          <input type="number" name="amount_paid" min="0" step="0.01">
                        </label>
                        <label>
                          <span>Paid Date</span>
                          <input type="date" name="paid_date">
                        </label>
                        <button type="submit">Update Paid</button>
                      </form>
                    </details>
                  {% else %}
                    <span class="muted">—</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="muted">No generated occurrences in this cycle yet.</p>
      {% endif %}
    </article>
  {% endfor %}
</section>
