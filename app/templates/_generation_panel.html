<div id="generation-panel">
  <article class="card">
    <h2>Occurrence Generation</h2>
    <p class="muted">Manually run Phase 2 occurrence generation for testing.</p>
    <form
      hx-post="/admin/run-generation"
      hx-target="#interactive-panels"
      hx-swap="outerHTML"
      method="post"
      class="inline-form"
    >
      <label>
        <span>Horizon (days)</span>
        <input type="number" name="horizon_days" min="1" max="365" value="{{ generation_state.horizon_days if generation_state else 90 }}">
      </label>
      <button type="submit">Run Generation</button>
    </form>
    <form
      hx-post="/admin/run-generation-once-today"
      hx-target="#interactive-panels"
      hx-swap="outerHTML"
      method="post"
      class="inline-form"
    >
      <input type="hidden" name="horizon_days" value="{{ generation_state.horizon_days if generation_state else 90 }}">
      <button type="submit">Run Once Today (Guarded)</button>
    </form>
    {% if generation_state %}
      {% if generation_state.mode == "guarded" %}
        {% if generation_state.ran %}
          <p class="success" role="status">Guarded run executed for {{ generation_state.run_date }}.</p>
        {% else %}
          <p class="warn" role="status">Guard blocked duplicate run for {{ generation_state.run_date }} (already ran today).</p>
        {% endif %}
      {% else %}
        <p class="success" role="status">Manual run executed (unguarded).</p>
      {% endif %}
      <div class="stack">
        {% if generation_state.range_start %}
          <div class="row"><span>Range</span><strong>{{ generation_state.range_start }} â†’ {{ generation_state.range_end }}</strong></div>
          <div class="row"><span>Inserted</span><strong>{{ generation_state.generated_count }}</strong></div>
          <div class="row"><span>Skipped Existing</span><strong>{{ generation_state.skipped_existing_count }}</strong></div>
        {% endif %}
        {% if generation_state.job_name %}
          <div class="row"><span>Job</span><strong>{{ generation_state.job_name }}</strong></div>
        {% endif %}
      </div>
    {% endif %}
  </article>
</div>
